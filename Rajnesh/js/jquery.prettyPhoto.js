var $pp_pic_holder, $ppt; !function (e) { function t(e, i) { e = e.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]"); var t = "[\\?&]" + e + "=([^&#]*)", p = new RegExp(t), o = p.exec(i); return null == o ? "" : o[1] } e.fn.prettyPhoto = function (p) { function o(t) { for (y = e(t), theRel = y.attr("rel"), galleryRegExp = /\[(?:.*)\]/, theGallery = galleryRegExp.exec(theRel), isSet = !1, setCount = 0, h(), i = 0; i < C.length; i++) -1 != e(C[i]).attr("rel").indexOf(theGallery) && (setCount++, setCount > 1 && (isSet = !0), e(C[i]).attr("href") == y.attr("href") && (H = setCount, arrayPosition = i)); w(), $pp_pic_holder.find("p.currentTextHolder").text(H + p.counter_separator_label + setCount), _(), e("#pp_full_res").hide(), $pp_pic_holder.find(".pp_loaderIcon").show() } function r() { isSet && "image" == k ? $pp_pic_holder.find(".pp_hoverContainer").fadeIn(p.animationSpeed) : $pp_pic_holder.find(".pp_hoverContainer").hide(), $pp_pic_holder.find(".pp_details").fadeIn(p.animationSpeed), p.showTitle && hasTitle && ($ppt.css({ top: $pp_pic_holder.offset().top - 22, left: $pp_pic_holder.offset().left + p.padding / 2, display: "none" }), $ppt.fadeIn(p.animationSpeed)) } function a() { $pp_pic_holder.find(".pp_hoverContainer,.pp_details").fadeOut(p.animationSpeed), $pp_pic_holder.find("#pp_full_res object,#pp_full_res embed").css("visibility", "hidden"), $pp_pic_holder.find("#pp_full_res").fadeOut(p.animationSpeed, function () { e(".pp_loaderIcon").show(), f() }), $ppt.fadeOut(p.animationSpeed) } function d(i) { "previous" == i ? (arrayPosition--, H--) : (arrayPosition++, H++), x || (x = !0), a(), e("a.pp_expand,a.pp_contract").fadeOut(p.animationSpeed, function () { e(this).removeClass("pp_contract").addClass("pp_expand") }) } function n() { $pp_pic_holder.find("object,embed").css("visibility", "hidden"), e("div.pp_pic_holder,div.ppt").fadeOut(p.animationSpeed), e("div.pp_overlay").fadeOut(p.animationSpeed, function () { e("div.pp_overlay,div.pp_pic_holder,div.ppt").remove(), e.browser.msie && 6 == e.browser.version && e("select").css("visibility", "visible"), p.callback() }), x = !0 } function s() { H == setCount ? ($pp_pic_holder.find("a.pp_next").css("visibility", "hidden"), $pp_pic_holder.find("a.pp_arrow_next").addClass("disabled").unbind("click")) : ($pp_pic_holder.find("a.pp_next").css("visibility", "visible"), $pp_pic_holder.find("a.pp_arrow_next.disabled").removeClass("disabled").bind("click", function () { return d("next"), !1 })), 1 == H ? ($pp_pic_holder.find("a.pp_previous").css("visibility", "hidden"), $pp_pic_holder.find("a.pp_arrow_previous").addClass("disabled").unbind("click")) : ($pp_pic_holder.find("a.pp_previous").css("visibility", "visible"), $pp_pic_holder.find("a.pp_arrow_previous.disabled").removeClass("disabled").bind("click", function () { return d("previous"), !1 })), $pp_pic_holder.find("p.currentTextHolder").text(H + p.counter_separator_label + setCount), y = isSet ? e(C[arrayPosition]) : y, h(), y.attr("title") ? $pp_pic_holder.find(".pp_description").show().html(unescape(y.attr("title"))) : $pp_pic_holder.find(".pp_description").hide().text(""), y.find("img").attr("alt") && p.showTitle ? (hasTitle = !0, $ppt.html(unescape(y.find("img").attr("alt")))) : hasTitle = !1 } function c(i, t) { if (hasBeenResized = !1, l(i, t), imageWidth = i, imageHeight = t, windowHeight = e(window).height(), windowWidth = e(window).width(), ($ > windowWidth || b > windowHeight) && x && p.allowresize && !S) { for (hasBeenResized = !0, notFitting = !0; notFitting;) $ > windowWidth ? (imageWidth = windowWidth - 200, imageHeight = t / i * imageWidth) : b > windowHeight ? (imageHeight = windowHeight - 200, imageWidth = i / t * imageHeight) : notFitting = !1, b = imageHeight, $ = imageWidth; l(imageWidth, imageHeight) } return { width: imageWidth, height: imageHeight, containerHeight: b, containerWidth: $, contentHeight: g, contentWidth: v, resized: hasBeenResized } } function l(e, i) { $pp_pic_holder.find(".pp_details").width(e).find(".pp_description").width(e - parseFloat($pp_pic_holder.find("a.pp_close").css("width"))), g = i + $pp_pic_holder.find(".pp_details").height() + parseFloat($pp_pic_holder.find(".pp_details").css("marginTop")) + parseFloat($pp_pic_holder.find(".pp_details").css("marginBottom")), v = e, b = g + $pp_pic_holder.find(".ppt").height() + $pp_pic_holder.find(".pp_top").height() + $pp_pic_holder.find(".pp_bottom").height(), $ = e + p.padding } function h() { k = y.attr("href").match(/youtube\.com\/watch/i) ? "youtube" : -1 != y.attr("href").indexOf(".mov") ? "quicktime" : -1 != y.attr("href").indexOf(".swf") ? "flash" : -1 != y.attr("href").indexOf("iframe") ? "iframe" : "image" } function _() { $pp_pic_holder && 0 != $pp_pic_holder.size() && (e.browser.opera ? (windowHeight = window.innerHeight, windowWidth = window.innerWidth) : (windowHeight = e(window).height(), windowWidth = e(window).width()), x && ($pHeight = $pp_pic_holder.height(), $pWidth = $pp_pic_holder.width(), $tHeight = $ppt.height(), projectedTop = windowHeight / 2 + z.scrollTop - $pHeight / 2, projectedTop < 0 && (projectedTop = 0 + $tHeight), $pp_pic_holder.css({ top: projectedTop, left: windowWidth / 2 + z.scrollLeft - $pWidth / 2 }), $ppt.css({ top: projectedTop - $tHeight, left: windowWidth / 2 + z.scrollLeft - $pWidth / 2 + p.padding / 2 }))) } function f() { s(), "image" == k ? (imgPreloader = new Image, nextImage = new Image, isSet && H > setCount && (nextImage.src = e(C[arrayPosition + 1]).attr("href")), prevImage = new Image, isSet && C[arrayPosition - 1] && (prevImage.src = e(C[arrayPosition - 1]).attr("href")), pp_typeMarkup = '<img id="fullResImage" src="" />', $pp_pic_holder.find("#pp_full_res")[0].innerHTML = pp_typeMarkup, $pp_pic_holder.find(".pp_content").css("overflow", "hidden"), $pp_pic_holder.find("#fullResImage").attr("src", y.attr("href")), imgPreloader.onload = function () { var e = c(imgPreloader.width, imgPreloader.height); imgPreloader.width = e.width, imgPreloader.height = e.height, showimage(imgPreloader.width, imgPreloader.height, e.containerWidth, e.containerHeight, e.contentHeight, e.contentWidth, e.resized) }, imgPreloader.src = y.attr("href")) : (movie_width = parseFloat(t("width", y.attr("href"))) ? t("width", y.attr("href")) : "425", movie_height = parseFloat(t("height", y.attr("href"))) ? t("height", y.attr("href")) : "344", -1 != movie_width.indexOf("%") || -1 != movie_height.indexOf("%") ? (movie_height = e(window).height() * parseFloat(movie_height) / 100 - 100, movie_width = e(window).width() * parseFloat(movie_width) / 100 - 100, parsentBased = !0) : (movie_height = parseFloat(movie_height), movie_width = parseFloat(movie_width)), "quicktime" == k && (movie_height += 13), correctSizes = c(movie_width, movie_height), "youtube" == k ? pp_typeMarkup = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="' + correctSizes.width + '" height="' + correctSizes.height + '"><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="http://www.youtube.com/v/' + t("v", y.attr("href")) + '" /><embed src="http://www.youtube.com/v/' + t("v", y.attr("href")) + '" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="' + correctSizes.width + '" height="' + correctSizes.height + '"></embed></object>' : "quicktime" == k ? pp_typeMarkup = '<object classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" codebase="http://www.apple.com/qtactivex/qtplugin.cab" height="' + correctSizes.height + '" width="' + correctSizes.width + '"><param name="src" value="' + y.attr("href") + '"><param name="autoplay" value="true"><param name="type" value="video/quicktime"><embed src="' + y.attr("href") + '" height="' + correctSizes.height + '" width="' + correctSizes.width + '" autoplay="true" type="video/quicktime" pluginspage="http://www.apple.com/quicktime/download/"></embed></object>' : "flash" == k ? (flash_vars = y.attr("href"), flash_vars = flash_vars.substring(y.attr("href").indexOf("flashvars") + 10, y.attr("href").length), filename = y.attr("href"), filename = filename.substring(0, filename.indexOf("?")), pp_typeMarkup = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="' + correctSizes.width + '" height="' + correctSizes.height + '"><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="' + filename + "?" + flash_vars + '" /><embed src="' + filename + "?" + flash_vars + '" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="' + correctSizes.width + '" height="' + correctSizes.height + '"></embed></object>') : "iframe" == k && (movie_url = y.attr("href"), movie_url = movie_url.substr(0, movie_url.indexOf("iframe") - 1), pp_typeMarkup = '<iframe src ="' + movie_url + '" width="' + (correctSizes.width - 10) + '" height="' + (correctSizes.height - 10) + '" frameborder="no"></iframe>'), $pp_pic_holder.find("#pp_full_res")[0].innerHTML = pp_typeMarkup, showimage(correctSizes.width, correctSizes.height, correctSizes.containerWidth, correctSizes.containerHeight, correctSizes.contentHeight, correctSizes.contentWidth, correctSizes.resized)) } function m() { return self.pageYOffset ? (scrollTop = self.pageYOffset, scrollLeft = self.pageXOffset) : document.documentElement && document.documentElement.scrollTop ? (scrollTop = document.documentElement.scrollTop, scrollLeft = document.documentElement.scrollLeft) : document.body && (scrollTop = document.body.scrollTop, scrollLeft = document.body.scrollLeft), { scrollTop: scrollTop, scrollLeft: scrollLeft } } function u() { e("div.pp_overlay").css({ height: e(document).height(), width: e(window).width() }) } function w() { toInject = "", toInject += "<div class='pp_overlay'></div>", "image" == k ? pp_typeMarkup = '<img id="fullResImage" src="" />' : pp_typeMarkup = "", toInject += '<div class="pp_pic_holder"><div class="pp_top"><div class="pp_left"></div><div class="pp_middle"></div><div class="pp_right"></div></div><div class="pp_content"><a href="#" class="pp_expand" title="Expand the image">Expand</a><div class="pp_loaderIcon"></div><div class="pp_hoverContainer"><a class="pp_next" href="#">next</a><a class="pp_previous" href="#">previous</a></div><div id="pp_full_res">' + pp_typeMarkup + '</div><div class="pp_details clearfix"><a class="pp_close" href="#">Close</a><p class="pp_description"></p><div class="pp_nav"><a href="#" class="pp_arrow_previous">Previous</a><p class="currentTextHolder">0' + p.counter_separator_label + '0</p><a href="#" class="pp_arrow_next">Next</a></div></div></div><div class="pp_bottom"><div class="pp_left"></div><div class="pp_middle"></div><div class="pp_right"></div></div></div>', toInject += '<div class="ppt"></div>', e("body").append(toInject), $pp_pic_holder = e(".pp_pic_holder"), $ppt = e(".ppt"), e("div.pp_overlay").css("height", e(document).height()).bind("click", function () { n() }), $pp_pic_holder.css({ opacity: 0 }).addClass(p.theme), e("a.pp_close").bind("click", function () { return n(), !1 }), e("a.pp_expand").bind("click", function () { return $this = e(this), $this.hasClass("pp_expand") ? ($this.removeClass("pp_expand").addClass("pp_contract"), x = !1) : ($this.removeClass("pp_contract").addClass("pp_expand"), x = !0), a(), $pp_pic_holder.find(".pp_hoverContainer, #pp_full_res, .pp_details").fadeOut(p.animationSpeed, function () { f() }), !1 }), $pp_pic_holder.find(".pp_previous, .pp_arrow_previous").bind("click", function () { return d("previous"), !1 }), $pp_pic_holder.find(".pp_next, .pp_arrow_next").bind("click", function () { return d("next"), !1 }), $pp_pic_holder.find(".pp_hoverContainer").css({ "margin-left": p.padding / 2 }), isSet || $pp_pic_holder.find(".pp_hoverContainer,.pp_nav").hide(), e.browser.msie && 6 == e.browser.version && (e("body").addClass("ie6"), e("select").css("visibility", "hidden")), e("div.pp_overlay").css("opacity", 0).fadeTo(p.animationSpeed, p.opacity, function () { $pp_pic_holder.css("opacity", 0).fadeIn(p.animationSpeed, function () { $pp_pic_holder.attr("style", "left:" + $pp_pic_holder.css("left") + ";top:" + $pp_pic_holder.css("top") + ";"), f() }) }) } var g, v, b, $, y, x = !0, S = !1, C = [], H = 0, k = "image", z = m(); e(window).scroll(function () { z = m(), _() }), e(window).resize(function () { _(), u() }), e(document).keypress(function (e) { switch (e.keyCode) { case 37: if (1 == H) return; d("previous"); break; case 39: if (H == setCount) return; d("next"); break; case 27: n() } }), p = jQuery.extend({ animationSpeed: "normal", padding: 40, opacity: .8, showTitle: !0, allowresize: !0, counter_separator_label: "/", theme: "light_rounded", callback: function () { } }, p), e.browser.msie && 6 == e.browser.version && (p.theme = "light_square"), e(this).each(function () { C[C.length] = this, e(this).bind("click", function () { return o(this), !1 }) }), showimage = function (i, t, o, a, d, n, s) { e(".pp_loaderIcon").hide(), e.browser.opera ? (windowHeight = window.innerHeight, windowWidth = window.innerWidth) : (windowHeight = e(window).height(), windowWidth = e(window).width()), $pp_pic_holder.find(".pp_content").animate({ height: d }, p.animationSpeed), projectedTop = z.scrollTop + (windowHeight / 2 - a / 2), projectedTop < 0 && (projectedTop = 0 + $pp_pic_holder.find(".ppt").height()), $pp_pic_holder.animate({ top: projectedTop, left: windowWidth / 2 - o / 2, width: o }, p.animationSpeed, function () { $pp_pic_holder.width(o), $pp_pic_holder.find(".pp_hoverContainer,#fullResImage").height(t).width(i), $pp_pic_holder.find("#pp_full_res").fadeIn(p.animationSpeed, function () { e(this).find("object,embed").css("visibility", "visible") }), r(), s && e("a.pp_expand,a.pp_contract").fadeIn(p.animationSpeed) }) } } }(jQuery);